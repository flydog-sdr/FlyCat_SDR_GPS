!function(t,o){"function"==typeof define&&define.amd?define(["leaflet","mapbox-gl"],o):"object"==typeof exports?module.exports=o(require("leaflet"),require("mapbox-gl")):t.returnExports=o(window.L,window.mapboxgl)}(this,function(t,o){t.MapboxGL=t.Layer.extend({options:{updateInterval:32},initialize:function(i){if(t.setOptions(this,i),!i.accessToken)throw new Error("You should provide a Mapbox GL access token as a token option.");o.accessToken=i.accessToken;var n,a,e,s,r,h,m;this._throttledUpdate=(n=t.Util.bind(this._update,this),a=this.options.updateInterval,m=function(){s=!1,r&&(h.apply(e,r),r=!1)},h=function(){s?r=arguments:(n.apply(e,arguments),setTimeout(m,a),s=!0)})},onAdd:function(o){this._glContainer||this._initContainer(),this.getPane().appendChild(this._glContainer),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),o.options.zoomAnimation&&t.DomEvent.on(o._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(o){this._map.options.zoomAnimation&&t.DomEvent.off(this._map._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this),this.getPane().removeChild(this._glContainer),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd}},_initContainer:function(){var o=this._glContainer=t.DomUtil.create("div","leaflet-gl-layer"),i=this._map.getSize();o.style.width=i.x+"px",o.style.height=i.y+"px"},_initGL:function(){var i=this._map.getCenter(),n=t.extend({},this.options,{container:this._glContainer,interactive:!1,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new o.Map(n),this._glMap.transform.latRange=null,this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas,t.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-image-layer"),t.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-zoom-animated")},_update:function(i){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var n=this._map.getSize(),a=this._glContainer,e=this._glMap,s=this._map.containerPointToLayerPoint([0,0]);t.DomUtil.setPosition(a,s);var r=this._map.getCenter(),h=e.transform;h.center=o.LngLat.convert([r.lng,r.lat]),h.zoom=this._map.getZoom()-1,e.transform.width!==n.x||e.transform.height!==n.y?(a.style.width=n.x+"px",a.style.height=n.y+"px",null!==e._resize&&void 0!==e._resize?e._resize():e.resize()):null!==e._update&&void 0!==e._update?e._update():e.update()}},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(o){var i=this._map.getZoomScale(o.zoom),n=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),o.zoom,o.center);t.DomUtil.setTransform(this._glMap._actualCanvas,n.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var o=this._map.getZoomScale(this._map.getZoom()),i=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),this._map.getZoom(),this._map.getCenter());t.DomUtil.setTransform(this._glMap._actualCanvas,i.subtract(this._offset),o),this._zooming=!1},_transitionEnd:function(o){t.Util.requestAnimFrame(function(){var o=this._map.getZoom(),i=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());t.DomUtil.setTransform(this._glMap._actualCanvas,n,1),this._glMap.once("moveend",t.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:i,zoom:o-1})},this)}}),t.mapboxGL=function(o){return new t.MapboxGL(o)}});