var DayNightOverlay=function(t){this.canvas_=null,this.fillColor_="rgba(0,0,0,0.5)",this.date_=this.id_=null,"object"==typeof t&&(void 0!==t.fillColor&&(this.fillColor_=t.fillColor),void 0!==t.id&&(this.id_=t.id),void 0!==t.date&&(this.date_=t.date),void 0!==t.map&&this.setMap(t.map))};DayNightOverlay.prototype=new google.maps.OverlayView,DayNightOverlay.NORTH_=new google.maps.LatLng(85,0),DayNightOverlay.SOUTH_=new google.maps.LatLng(-85,0),DayNightOverlay.prototype.onAdd=function(){this.canvas_=document.createElement("canvas"),this.canvas_.style.position="absolute",this.id_&&(this.canvas_.id=this.id_),this.getPanes().overlayLayer.appendChild(this.canvas_)},DayNightOverlay.prototype.onRemove=function(){this.canvas_.parentNode.removeChild(this.canvas_),this.canvas_=null},DayNightOverlay.prototype.draw=function(){var t=this.getProjection(),e=this.getWorldDimensions_(t);t=this.getVisibleDimensions_(t,250);3>this.getMap().getZoom()&&(t.x=e.x-e.width,t.y=e.y,t.width=3*e.width,t.height=e.height),this.canvas_.style.left=t.x+"px",this.canvas_.style.top=t.y+"px",this.canvas_.style.width=t.width+"px",this.canvas_.style.height=t.height+"px",this.canvas_.width=t.width,this.canvas_.height=t.height;var i=this.canvas_.getContext("2d");i.clearRect(0,0,t.width,t.height);e=this.createTerminatorFunc_(t,e);var a=this.isNorthernSun_(this.date_?this.date_:new Date);i.fillStyle=this.fillColor_,i.beginPath(),i.moveTo(0,a?t.height:0);for(var h=0;h<t.width;h++)i.lineTo(h,e(h));i.lineTo(t.width,a?t.height:0),i.fill()},DayNightOverlay.prototype.setDate=function(t){this.date_=t,null!==this.canvas_&&this.draw()},DayNightOverlay.prototype.getWorldDimensions_=function(t){var e=t.fromLatLngToDivPixel(DayNightOverlay.NORTH_),i=t.fromLatLngToDivPixel(DayNightOverlay.SOUTH_);t=t.getWorldWidth();return{x:e.x-t/2,y:e.y,width:t,height:i.y-e.y}},DayNightOverlay.prototype.getVisibleDimensions_=function(t,e){var i=t.fromLatLngToDivPixel(this.getMap().getBounds().getNorthEast()),a=t.fromLatLngToDivPixel(this.getMap().getBounds().getSouthWest());return{x:a.x-e,y:i.y-e,width:i.x-a.x+2*e,height:a.y-i.y+2*e}},DayNightOverlay.prototype.createTerminatorFunc_=function(t,e){var i=this.date_?this.date_:new Date,a=2*Math.PI,h=e.height/2,n=t.height,o=t.x-e.x,s=t.y-e.y,r=a/e.width,l=e.height/Math.PI,g=(3600*i.getUTCHours()+60*i.getUTCMinutes()+i.getUTCSeconds()+43200)*(a/86400),y=this.getDayOfYear_(i),v=(i=this.getDayOfYear_(new Date(Date.UTC(i.getFullYear(),2,20))),23.44*Math.PI/90),d=Math.sin(a*(y-i)/365)*v;return function(t){return t=Math.atan(-Math.cos((t+o)*r+g)/Math.tan(d)),t=h+t*l,Math.min(n,Math.max(0,t-s))}},DayNightOverlay.prototype.isNorthernSun_=function(t){var e=new Date(Date.UTC(t.getFullYear(),2,19)),i=new Date(Date.UTC(t.getFullYear(),8,18));return t.getTime()>e.getTime()&&t.getTime()<=i.getTime()},DayNightOverlay.prototype.getDayOfYear_=function(t){var e=new Date(Date.UTC(t.getFullYear(),0,1));return Math.ceil((t.getTime()-e.getTime())/864e5)};